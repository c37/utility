!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("aws-sdk"),require("react")):"function"==typeof define&&define.amd?define(["exports","aws-sdk","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["@ciro-maciel/utility"]={},e["aws-sdk"],e.react)}(this,(function(e,t,s){"use strict";const r=e=>{const t=e;return t.validate=t=>r((async(s,r,n,a)=>(await e(s,r,n,a),t(s,r,n,a)))),t};var n=r(((e,t,{auth:s})=>{if(!s||!s.authenticated){const{message:e="Not Authenticated",code:t="NOT_AUTHENTICATED",status:r=401}=s||{},n=new Error(e);throw n.code=t,n.status=r,n}}));const a=require("jsonwebtoken"),{SECRET:i}=process.env;var o={cucAuthorizationStrategy:e=>{if(!e){const e=new Error("The cuc is missing");throw e.code="MISSING_CUC",e.status=401,e}return{account:e,authenticated:!0}},jwtAuthorizationStrategy:e=>{if(!e){const e=new Error("The api token is missing");throw e.code="MISSING_TOKEN",e.status=401,e}let t=null,s=!1;const r=e.split(" ");if(2===!r.length){const e=new Error("The api token is invalid");throw e.code="INVALID_TOKEN",e.status=401,e}const[n,o]=r;if("Bearer"!==n){const e=new Error("The api token is malformatted");throw e.code="MALFORMATTED_TOKEN",e.status=401,e}try{t=a.verify(o,i),s=!!t}catch(e){}return{...t,authenticated:s}},authentication:n,Authorization:class{constructor(e){this.authorization=e}verify(e){return this.authorization(e)}}};const l=process.env.IS_OFFLINE;const c=e=>{for(const t in e)"object"==typeof e[t]&&null!==e[t]?Object.keys(e[t]).length?c(e[t]):delete e[t]:""!==e[t]&&null!==e[t]&&void 0!==e[t]||delete e[t];return e},u=({type:e,operator:t,field:s,value:r})=>{if("A".includes(e)){let e="(";return r.forEach(((t,n)=>{e+=`contains(#${s}, :${s}${n})`,e+=n!==r.length-1?" or ":""})),e+")"}switch(t){case"startswith":return`begins_with(#${s}, :${s})`;case"contains":return`contains(#${s}, :${s})`;case"in":return`#${s} IN (${r.split(",").map(((e,t)=>`:${s}${t}`)).join(",")})`;case"between":return`#${s} BETWEEN ${r.split(",").map(((e,t)=>`:${s}${t}`)).join(" AND ")}`;case"neq":return`#${s} <> :${s}`;case"gt":return`#${s} > :${s}`;case"gte":return`#${s} >= :${s}`;case"lt":return`#${s} < :${s}`;case"lte":return`#${s} <= :${s}`;case"isnotnull":return`NOT attribute_type(#${s}, :${s})`;case"isnull":return`attribute_type(#${s}, :${s})`;default:return`#${s} = :${s}`}},p=(e=[],t="#",s="field",r="field")=>e.reduce(((e,n)=>{const a=":"===t;if(a&&["isnotnull","isnull"].includes(n.operator))return{...e,[`${t}${n[s]}`]:"NULL"};if(a&&["between","in"].includes(n.operator))return((e,t,s,r,n)=>({...e,...t.split(",").reduce(((e,t,a)=>({...e,[`${s}${r}${a}`]:"N"===n?parseFloat(t):t})),{})}))(e,n.value,t,n.field,n.type);if(a&&"A".includes(n.type)){let r={...e};return n.value.forEach(((e,a)=>{r[`${t}${n[s]}${a}`]=e})),r}return{...e,[`${t}${n[s]}`]:a?"N"===n.type?parseFloat(n[r]):"B"===n.type?"true"===n[r]:n[r]:n[r]}}),{}),d=(e=[])=>{const t=[],s=e.filter((({operator:e,isKey:s,field:r},n)=>!(!s&&0!==n||e&&["startswith","contains","in","neq"].includes(e))&&t.push(r)>0)),r=e.filter((({field:e})=>!t.includes(e))),n=p(e,"#","field","field"),a=`${s.map(u).join(" and ")}`,i=`${r.map(u).join(" and ")}`;return{KeyConditionExpression:a,ExpressionAttributeNames:n,ExpressionAttributeValues:p(e,":","field","value"),FilterExpression:i}};var h={Dynamo:class{constructor(e={convertEmptyValues:!0}){l&&(e.region="localhost",e.endpoint="http://localhost:4040",e.accessKeyId="DEFAULT_ACCESS_KEY",e.secretAccessKey="DEFAULT_SECRET"),t.config.update(e);try{const e=new t.DynamoDB,s=new t.DynamoDB.DocumentClient;Object.assign(this,{client:s,dynamo:e})}catch(e){throw console.error(e),e}}static parseOperator(e){switch(e){case"startswith":return"BEGINS_WITH";case"contains":return"CONTAINS";case"in":return"IN";case"between":return"BETWEEN";case"neq":return"NE";case"gt":return"GT";case"gte":return"GE";case"lt":return"LT";case"lte":return"LE";case"isnotnull":return"NOT_NULL";case"isnull":return"NULL";default:return"EQ"}}static parseValue(e){try{if("string"==typeof e.value&&e.value.includes(",")&&"in"===e.operator)return e.value.split(",").map((t=>"N"===e.type?parseFloat(t):t))}catch(t){throw console.error(t,e),t}switch(e.type){case"N":return[parseFloat(e.value)];case"B":return[!!parseFloat(e.value)];default:return[e.value]}}static parseFilter(e){return e.filter((({value:e})=>!!e)).reduce(((e,t)=>({...e,[t.field]:{ComparisonOperator:this.parseOperator(t.operator),AttributeValueList:this.parseValue(t)}})),{})}async createTable(e,t={}){const s={TableName:e,KeySchema:[{AttributeName:"id",KeyType:"HASH"}],AttributeDefinitions:[{AttributeName:"id",AttributeType:"N"}],ProvisionedThroughput:{ReadCapacityUnits:5,WriteCapacityUnits:5}};t.indexes&&(s.globalIndexes=t.indexes.filter({type:"global"}).keyBy("name").value(),s.secondaryIndexes=t.indexes.filter({type:"local"}).keyBy("name").value());try{return this.dynamo.createTable(s).promise()}catch(e){throw console.error(e),e}}async deleteTable(e){try{return this.dynamo.deleteTable({TableName:e}).promise()}catch(e){throw console.error(e),e}}withTable(e){return this.tableName=e,this}async put(e){try{return await this.client.put({TableName:this.tableName,Item:e}).promise()}catch(t){throw console.error(t,e),t}}async update(e,{updateExpression:t,expressionAttributeNames:s,expressionAttributeValues:r,returnValues:n="UPDATED_NEW"}){const a={TableName:this.tableName,Key:e,UpdateExpression:t,ExpressionAttributeNames:s,ExpressionAttributeValues:r,ReturnValues:n};try{return(await this.client.update(a).promise()).Attributes}catch(e){throw console.error(e),e}}async delete(e,t){const s={TableName:this.tableName,Key:e};return t&&(s.ConditionExpression=t.expression,s.ExpressionAttributeValues=t.values),await this.client.delete(s).promise(),!0}async findByKey(e){const t={TableName:this.tableName,Key:e};return(await this.client.get(t).promise()).Item}async get(e){const t={TableName:this.tableName,Key:e};return(await this.client.get(t).promise()).Item}async findAll(){return(await this.client.scan({TableName:this.tableName}).promise()).Items}async filter({indexName:e=null,filter:t=null,limit:s=null,skip:r=null,sort:n=null,attributesToGetString:a=null,lean:i=!1}){const{KeyConditionExpression:o,ExpressionAttributeNames:l,ExpressionAttributeValues:u,FilterExpression:p}=d(t),h=c({TableName:this.tableName,IndexName:e,KeyConditionExpression:o,ExpressionAttributeNames:l,ExpressionAttributeValues:u,FilterExpression:p,ProjectionExpression:a}),{Count:m}=await this.client.query({...h,Select:"COUNT"}).promise();n&&(h.ScanIndexForward="desc"!==n.dir),s&&(h.Limit=s),r&&(h.ExclusiveStartKey=r);let y=await this.client.query(h).promise(),f=[...y.Items];if("test"===process.env.STAGE&&console.log("params",h),"test"===process.env.STAGE&&console.log("response",y),y.LastEvaluatedKey)for(;y.LastEvaluatedKey;)if(h.ExclusiveStartKey=y.LastEvaluatedKey,y=await this.client.query(h).promise(),"test"===process.env.STAGE&&console.log("w - params",h),"test"===process.env.STAGE&&console.log("w - response",y),s&&f.length+y.Items.length>s){const e=s-f.length;f=f.concat(y.Items.slice(0,e)),y.LastEvaluatedKey=null}else f=f.concat(y.Items);return{count:m,items:f}}}};class m extends class{constructor(e,t){Object.assign(this,{database:e,tableName:t})}async findByKey(e){return this.database.withTable(this.tableName).findByKey(e)}async findAll(){return this.database.withTable(this.tableName).findAll()}async filter({indexName:e,limit:t,skip:s,sort:r,filter:n,attributesToGetString:a}){return this.database.withTable(this.tableName).filter({indexName:e,limit:t,skip:s,sort:r,filter:n,attributesToGetString:a})}async put(e){return this.database.withTable(this.tableName).put(e)}async delete(e){return this.database.withTable(this.tableName).delete(e)}}{constructor(e,t){super(e,t)}}var y={management:o,persistence:{databases:h,UnitOfWork:class{constructor(e,t){Object.assign(this,{database:e,tableName:t}),this.constructor.container=new Map}repository(){const{container:e}=this.constructor,t=new m(this.database,this.tableName);return e.set(this.tableName,t),t}}}},f={hooks:{useUpdate:(e,t)=>{const r=s.useRef(!1);s.useEffect((()=>{r.current?e():r.current=!0}),t)}}},b={math:{guid:function(e,t){var s,r,n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=[];if(t=t||n.length,e)for(s=0;s<e;s++)a[s]=n[0|Math.random()*t];else for(a[8]=a[13]=a[18]=a[23]="-",a[14]="4",s=0;s<36;s++)a[s]||(r=0|16*Math.random(),a[s]=n[19==s?3&r|8:r]);return a.join("").toLowerCase()}},string:{toHex:function(e){for(var t="",s=0;s<e.length;s++)t+=e[s].charCodeAt(0).toString(16);return t},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)}},func:{debounce:function(e,t,s){var r;return function(){var n=this,a=arguments,i=function(){r=null,s||e.apply(n,a)},o=s&&!r;clearTimeout(r),r=setTimeout(i,t),o&&e.apply(n,a)}}},network:{request:function(e){return new Promise((function(t,s){var r=new XMLHttpRequest;r.open(e.method||"GET",e.url),e.headers&&Object.keys(e.headers).forEach((function(t){r.setRequestHeader(t,e.headers[t])})),r.onload=function(){t({code:r.status,message:r.response||r.responseText})},r.onerror=function(){s(r.statusText)},r.send(e.body)}))},info:{data:null,load:function(){utility.net.request({url:"https://ipapi.co/json/"}).then((function(e){200===e.code&&(utility.net.info.data=JSON.parse(e.message))})).catch((function(e){utility.net.info.data={}}))}}},http:{response:(e,t="json")=>"json"===t?{statusCode:200,body:JSON.stringify({payload:e}),headers:{"Content-Type":"application/json"}}:{statusCode:200,body:e,isBase64Encoded:!0,headers:{"Access-Control-Allow-Origin":"*","Content-disposition":`attachment; filename=${(new Date).toISOString()}.${"img"===t?"jpg":"pdf"}`,"Content-Type":"img"===t?"image/jpg":"application/pdf"}},size:e=>{let t,s,r;t=e.endsWith("==")?2:e.endsWith("=")?1:0,r=e.length,s=r/4*3-t;return s/1e3}}};e.backEnd=y,e.frontEnd=f,e.utility=b,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=main.min.js.map
