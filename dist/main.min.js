import{config as e,DynamoDB as t}from"aws-sdk";import{useRef as s,useEffect as r}from"react";const a=e=>{const t=e;return t.validate=t=>a((async(s,r,a,n)=>(await e(s,r,a,n),t(s,r,a,n)))),t};var n=a(((e,t,{auth:s})=>{if(!s||!s.authenticated){const{message:e="Not Authenticated",code:t="NOT_AUTHENTICATED",status:r=401}=s||{},a=new Error(e);throw a.code=t,a.status=r,a}}));const i=require("jsonwebtoken"),{SECRET:o}=process.env;var l={cucAuthorizationStrategy:e=>{if(!e){const e=new Error("The cuc is missing");throw e.code="MISSING_CUC",e.status=401,e}return{account:e,authenticated:!0}},jwtAuthorizationStrategy:e=>{if(!e){const e=new Error("The api token is missing");throw e.code="MISSING_TOKEN",e.status=401,e}let t=null,s=!1;const r=e.split(" ");if(2===!r.length){const e=new Error("The api token is invalid");throw e.code="INVALID_TOKEN",e.status=401,e}const[a,n]=r;if("Bearer"!==a){const e=new Error("The api token is malformatted");throw e.code="MALFORMATTED_TOKEN",e.status=401,e}try{t=i.verify(n,o),s=!!t}catch(e){}return{...t,authenticated:s}},authentication:n,Authorization:class{constructor(e){this.authorization=e}verify(e){return this.authorization(e)}}};const c=process.env.IS_OFFLINE;const u=e=>{for(const t in e)"object"==typeof e[t]&&null!==e[t]?Object.keys(e[t]).length?u(e[t]):delete e[t]:""!==e[t]&&null!==e[t]&&void 0!==e[t]||delete e[t];return e},p=({type:e,operator:t,field:s,value:r})=>{if("A".includes(e)){let e="(";return r.forEach(((t,a)=>{e+=`contains(#${s}, :${s}${a})`,e+=a!==r.length-1?" or ":""})),e+")"}switch(t){case"startswith":return`begins_with(#${s}, :${s})`;case"contains":return`contains(#${s}, :${s})`;case"in":return`#${s} IN (${r.split(",").map(((e,t)=>`:${s}${t}`)).join(",")})`;case"between":return`#${s} BETWEEN ${r.split(",").map(((e,t)=>`:${s}${t}`)).join(" AND ")}`;case"neq":return`#${s} <> :${s}`;case"gt":return`#${s} > :${s}`;case"gte":return`#${s} >= :${s}`;case"lt":return`#${s} < :${s}`;case"lte":return`#${s} <= :${s}`;case"isnotnull":return`NOT attribute_type(#${s}, :${s})`;case"isnull":return`attribute_type(#${s}, :${s})`;default:return`#${s} = :${s}`}},d=(e=[],t="#",s="field",r="field")=>e.reduce(((e,a)=>{const n=":"===t;if(n&&["isnotnull","isnull"].includes(a.operator))return{...e,[`${t}${a[s]}`]:"NULL"};if(n&&["between","in"].includes(a.operator))return((e,t,s,r,a)=>({...e,...t.split(",").reduce(((e,t,n)=>({...e,[`${s}${r}${n}`]:"N"===a?parseFloat(t):t})),{})}))(e,a.value,t,a.field,a.type);if(n&&"A".includes(a.type)){let r={...e};return a.value.forEach(((e,n)=>{r[`${t}${a[s]}${n}`]=e})),r}return{...e,[`${t}${a[s]}`]:n?"N"===a.type?parseFloat(a[r]):"B"===a.type?"true"===a[r]:a[r]:a[r]}}),{}),h=(e=[])=>{const t=[],s=e.filter((({operator:e,isKey:s,field:r},a)=>!(!s&&0!==a||e&&["startswith","contains","in","neq"].includes(e))&&t.push(r)>0)),r=e.filter((({field:e})=>!t.includes(e))),a=d(e,"#","field","field"),n=`${s.map(p).join(" and ")}`,i=`${r.map(p).join(" and ")}`;return{KeyConditionExpression:n,ExpressionAttributeNames:a,ExpressionAttributeValues:d(e,":","field","value"),FilterExpression:i}};var m={Dynamo:class{constructor(s={convertEmptyValues:!0}){c&&(s.region="localhost",s.endpoint="http://localhost:4040",s.accessKeyId="DEFAULT_ACCESS_KEY",s.secretAccessKey="DEFAULT_SECRET"),e.update(s);try{const e=new t,s=new t.DocumentClient;Object.assign(this,{client:s,dynamo:e})}catch(e){throw console.error(e),e}}static parseOperator(e){switch(e){case"startswith":return"BEGINS_WITH";case"contains":return"CONTAINS";case"in":return"IN";case"between":return"BETWEEN";case"neq":return"NE";case"gt":return"GT";case"gte":return"GE";case"lt":return"LT";case"lte":return"LE";case"isnotnull":return"NOT_NULL";case"isnull":return"NULL";default:return"EQ"}}static parseValue(e){try{if("string"==typeof e.value&&e.value.includes(",")&&"in"===e.operator)return e.value.split(",").map((t=>"N"===e.type?parseFloat(t):t))}catch(t){throw console.error(t,e),t}switch(e.type){case"N":return[parseFloat(e.value)];case"B":return[!!parseFloat(e.value)];default:return[e.value]}}static parseFilter(e){return e.filter((({value:e})=>!!e)).reduce(((e,t)=>({...e,[t.field]:{ComparisonOperator:this.parseOperator(t.operator),AttributeValueList:this.parseValue(t)}})),{})}async createTable(e,t={}){const s={TableName:e,KeySchema:[{AttributeName:"id",KeyType:"HASH"}],AttributeDefinitions:[{AttributeName:"id",AttributeType:"N"}],ProvisionedThroughput:{ReadCapacityUnits:5,WriteCapacityUnits:5}};t.indexes&&(s.globalIndexes=t.indexes.filter({type:"global"}).keyBy("name").value(),s.secondaryIndexes=t.indexes.filter({type:"local"}).keyBy("name").value());try{return this.dynamo.createTable(s).promise()}catch(e){throw console.error(e),e}}async deleteTable(e){try{return this.dynamo.deleteTable({TableName:e}).promise()}catch(e){throw console.error(e),e}}withTable(e){return this.tableName=e,this}async put(e){try{return await this.client.put({TableName:this.tableName,Item:e}).promise()}catch(t){throw console.error(t,e),t}}async update(e,{updateExpression:t,expressionAttributeNames:s,expressionAttributeValues:r,returnValues:a="UPDATED_NEW"}){const n={TableName:this.tableName,Key:e,UpdateExpression:t,ExpressionAttributeNames:s,ExpressionAttributeValues:r,ReturnValues:a};try{return(await this.client.update(n).promise()).Attributes}catch(e){throw console.error(e),e}}async delete(e,t){const s={TableName:this.tableName,Key:e};return t&&(s.ConditionExpression=t.expression,s.ExpressionAttributeValues=t.values),await this.client.delete(s).promise(),!0}async findByKey(e){const t={TableName:this.tableName,Key:e};return(await this.client.get(t).promise()).Item}async get(e){const t={TableName:this.tableName,Key:e};return(await this.client.get(t).promise()).Item}async findAll(){return(await this.client.scan({TableName:this.tableName}).promise()).Items}async filter({indexName:e=null,filter:t=null,limit:s=null,skip:r=null,sort:a=null,attributesToGetString:n=null,lean:i=!1}){const{KeyConditionExpression:o,ExpressionAttributeNames:l,ExpressionAttributeValues:c,FilterExpression:p}=h(t),d=u({TableName:this.tableName,IndexName:e,KeyConditionExpression:o,ExpressionAttributeNames:l,ExpressionAttributeValues:c,FilterExpression:p,ProjectionExpression:n}),{Count:m}=await this.client.query({...d,Select:"COUNT"}).promise();a&&(d.ScanIndexForward="desc"!==a.dir),s&&(d.Limit=s),r&&(d.ExclusiveStartKey=r);let y=await this.client.query(d).promise(),b=[...y.Items];if("test"===process.env.STAGE&&console.log("params",d),"test"===process.env.STAGE&&console.log("response",y),y.LastEvaluatedKey)for(;y.LastEvaluatedKey;)if(d.ExclusiveStartKey=y.LastEvaluatedKey,y=await this.client.query(d).promise(),"test"===process.env.STAGE&&console.log("w - params",d),"test"===process.env.STAGE&&console.log("w - response",y),s&&b.length+y.Items.length>s){const e=s-b.length;b=b.concat(y.Items.slice(0,e)),y.LastEvaluatedKey=null}else b=b.concat(y.Items);return{count:m,items:b}}}};class y extends class{constructor(e,t){Object.assign(this,{database:e,tableName:t})}async findByKey(e){return this.database.withTable(this.tableName).findByKey(e)}async findAll(){return this.database.withTable(this.tableName).findAll()}async filter({indexName:e,limit:t,skip:s,sort:r,filter:a,attributesToGetString:n}){return this.database.withTable(this.tableName).filter({indexName:e,limit:t,skip:s,sort:r,filter:a,attributesToGetString:n})}async put(e){return this.database.withTable(this.tableName).put(e)}async delete(e){return this.database.withTable(this.tableName).delete(e)}}{constructor(e,t){super(e,t)}}var b={management:l,persistence:{databases:m,UnitOfWork:class{constructor(e,t){Object.assign(this,{database:e,tableName:t}),this.constructor.container=new Map}repository(){const{container:e}=this.constructor,t=new y(this.database,this.tableName);return e.set(this.tableName,t),t}}}},f={hooks:{useUpdate:(e,t)=>{const a=s(!1);r((()=>{a.current?e():a.current=!0}),t)}}},E={math:{guid:function(e,t){var s,r,a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=[];if(t=t||a.length,e)for(s=0;s<e;s++)n[s]=a[0|Math.random()*t];else for(n[8]=n[13]=n[18]=n[23]="-",n[14]="4",s=0;s<36;s++)n[s]||(r=0|16*Math.random(),n[s]=a[19==s?3&r|8:r]);return n.join("").toLowerCase()}},string:{toHex:function(e){for(var t="",s=0;s<e.length;s++)t+=e[s].charCodeAt(0).toString(16);return t},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)}},func:{debounce:function(e,t,s){var r;return function(){var a=this,n=arguments,i=function(){r=null,s||e.apply(a,n)},o=s&&!r;clearTimeout(r),r=setTimeout(i,t),o&&e.apply(a,n)}}},network:{request:function(e){return new Promise((function(t,s){var r=new XMLHttpRequest;r.open(e.method||"GET",e.url),e.headers&&Object.keys(e.headers).forEach((function(t){r.setRequestHeader(t,e.headers[t])})),r.onload=function(){t({code:r.status,message:r.response||r.responseText})},r.onerror=function(){s(r.statusText)},r.send(e.body)}))},info:{data:null,load:function(){utility.net.request({url:"https://ipapi.co/json/"}).then((function(e){200===e.code&&(utility.net.info.data=JSON.parse(e.message))})).catch((function(e){utility.net.info.data={}}))}}},http:{response:(e,t="json")=>"json"===t?{statusCode:200,body:JSON.stringify({payload:e}),headers:{"Content-Type":"application/json"}}:{statusCode:200,body:e,isBase64Encoded:!0,headers:{"Access-Control-Allow-Origin":"*","Content-disposition":`attachment; filename=${(new Date).toISOString()}.${"img"===t?"jpg":"pdf"}`,"Content-Type":"img"===t?"image/jpg":"application/pdf"}},size:e=>{let t,s,r;t=e.endsWith("==")?2:e.endsWith("=")?1:0,r=e.length,s=r/4*3-t;return s/1e3}}};export{b as backEnd,f as frontEnd,E as utility};
//# sourceMappingURL=main.min.js.map
