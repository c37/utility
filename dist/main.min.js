!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["@ciro-maciel/utility"]={})}(this,(function(e){"use strict";const t=e=>{const s=e;return s.validate=s=>t((async(t,n,r,a)=>(await e(t,n,r,a),s(t,n,r,a)))),s};var s=t(((e,t,{auth:s})=>{if(!s||!s.authenticated){const{message:e="Not Authenticated",code:t="NOT_AUTHENTICATED",status:n=401}=s||{},r=new Error(e);throw r.code=t,r.status=n,r}}));const n=require("jsonwebtoken"),{SECRET:r}=process.env;var a={cucAuthorizationStrategy:e=>{if(!e){const e=new Error("The cuc is missing");throw e.code="MISSING_CUC",e.status=401,e}return{account:e,authenticated:!0}},jwtAuthorizationStrategy:e=>{if(!e){const e=new Error("The api token is missing");throw e.code="MISSING_TOKEN",e.status=401,e}let t=null,s=!1;const a=e.split(" ");if(2===!a.length){const e=new Error("The api token is invalid");throw e.code="INVALID_TOKEN",e.status=401,e}const[i,o]=a;if("Bearer"!==i){const e=new Error("The api token is malformatted");throw e.code="MALFORMATTED_TOKEN",e.status=401,e}try{t=n.verify(o,r),s=!!t}catch(e){}return{...t,authenticated:s}},authentication:s,Authorization:class{constructor(e){this.authorization=e}verify(e){return this.authorization(e)}}};const i=process.env.IS_OFFLINE;const o=e=>{for(const t in e)"object"==typeof e[t]&&null!==e[t]?Object.keys(e[t]).length?o(e[t]):delete e[t]:""!==e[t]&&null!==e[t]&&void 0!==e[t]||delete e[t];return e},l=({type:e,operator:t,field:s,value:n})=>{if("A".includes(e)){let e="(";return n.forEach(((t,r)=>{e+=`contains(#${s}, :${s}${r})`,e+=r!==n.length-1?" or ":""})),e+")"}switch(t){case"startswith":return`begins_with(#${s}, :${s})`;case"contains":return`contains(#${s}, :${s})`;case"in":return`#${s} IN (${n.split(",").map(((e,t)=>`:${s}${t}`)).join(",")})`;case"between":return`#${s} BETWEEN ${n.split(",").map(((e,t)=>`:${s}${t}`)).join(" AND ")}`;case"neq":return`#${s} <> :${s}`;case"gt":return`#${s} > :${s}`;case"gte":return`#${s} >= :${s}`;case"lt":return`#${s} < :${s}`;case"lte":return`#${s} <= :${s}`;case"isnotnull":return`NOT attribute_type(#${s}, :${s})`;case"isnull":return`attribute_type(#${s}, :${s})`;default:return`#${s} = :${s}`}},c=(e=[],t="#",s="field",n="field")=>e.reduce(((e,r)=>{const a=":"===t;if(a&&["isnotnull","isnull"].includes(r.operator))return{...e,[`${t}${r[s]}`]:"NULL"};if(a&&["between","in"].includes(r.operator))return((e,t,s,n,r)=>({...e,...t.split(",").reduce(((e,t,a)=>({...e,[`${s}${n}${a}`]:"N"===r?parseFloat(t):t})),{})}))(e,r.value,t,r.field,r.type);if(a&&"A".includes(r.type)){let n={...e};return r.value.forEach(((e,a)=>{n[`${t}${r[s]}${a}`]=e})),n}return{...e,[`${t}${r[s]}`]:a?"N"===r.type?parseFloat(r[n]):"B"===r.type?"true"===r[n]:r[n]:r[n]}}),{}),u=(e=[])=>{const t=[],s=e.filter((({operator:e,isKey:s,field:n},r)=>!(!s&&0!==r||e&&["startswith","contains","in","neq"].includes(e))&&t.push(n)>0)),n=e.filter((({field:e})=>!t.includes(e))),r=c(e,"#","field","field"),a=`${s.map(l).join(" and ")}`,i=`${n.map(l).join(" and ")}`;return{KeyConditionExpression:a,ExpressionAttributeNames:r,ExpressionAttributeValues:c(e,":","field","value"),FilterExpression:i}};var p={Dynamo:class{constructor(e={convertEmptyValues:!0}){i&&(e.region="localhost",e.endpoint="http://localhost:4040",e.accessKeyId="DEFAULT_ACCESS_KEY",e.secretAccessKey="DEFAULT_SECRET"),aws,sdk.config.update(e);try{const e=new aws-sdk.DynamoDB(),t=new aws-sdk.DynamoDB.DocumentClient();Object.assign(this,{client:t,dynamo:e})}catch(e){throw console.error(e),e}}static parseOperator(e){switch(e){case"startswith":return"BEGINS_WITH";case"contains":return"CONTAINS";case"in":return"IN";case"between":return"BETWEEN";case"neq":return"NE";case"gt":return"GT";case"gte":return"GE";case"lt":return"LT";case"lte":return"LE";case"isnotnull":return"NOT_NULL";case"isnull":return"NULL";default:return"EQ"}}static parseValue(e){try{if("string"==typeof e.value&&e.value.includes(",")&&"in"===e.operator)return e.value.split(",").map((t=>"N"===e.type?parseFloat(t):t))}catch(t){throw console.error(t,e),t}switch(e.type){case"N":return[parseFloat(e.value)];case"B":return[!!parseFloat(e.value)];default:return[e.value]}}static parseFilter(e){return e.filter((({value:e})=>!!e)).reduce(((e,t)=>({...e,[t.field]:{ComparisonOperator:this.parseOperator(t.operator),AttributeValueList:this.parseValue(t)}})),{})}async createTable(e,t={}){const s={TableName:e,KeySchema:[{AttributeName:"id",KeyType:"HASH"}],AttributeDefinitions:[{AttributeName:"id",AttributeType:"N"}],ProvisionedThroughput:{ReadCapacityUnits:5,WriteCapacityUnits:5}};t.indexes&&(s.globalIndexes=t.indexes.filter({type:"global"}).keyBy("name").value(),s.secondaryIndexes=t.indexes.filter({type:"local"}).keyBy("name").value());try{return this.dynamo.createTable(s).promise()}catch(e){throw console.error(e),e}}async deleteTable(e){try{return this.dynamo.deleteTable({TableName:e}).promise()}catch(e){throw console.error(e),e}}withTable(e){return this.tableName=e,this}async put(e){try{return await this.client.put({TableName:this.tableName,Item:e}).promise()}catch(t){throw console.error(t,e),t}}async update(e,{updateExpression:t,expressionAttributeNames:s,expressionAttributeValues:n,returnValues:r="UPDATED_NEW"}){const a={TableName:this.tableName,Key:e,UpdateExpression:t,ExpressionAttributeNames:s,ExpressionAttributeValues:n,ReturnValues:r};try{return(await this.client.update(a).promise()).Attributes}catch(e){throw console.error(e),e}}async delete(e,t){const s={TableName:this.tableName,Key:e};return t&&(s.ConditionExpression=t.expression,s.ExpressionAttributeValues=t.values),await this.client.delete(s).promise(),!0}async findByKey(e){const t={TableName:this.tableName,Key:e};return(await this.client.get(t).promise()).Item}async get(e){const t={TableName:this.tableName,Key:e};return(await this.client.get(t).promise()).Item}async findAll(){return(await this.client.scan({TableName:this.tableName}).promise()).Items}async filter({indexName:e=null,filter:t=null,limit:s=null,skip:n=null,sort:r=null,attributesToGetString:a=null,lean:i=!1}){const{KeyConditionExpression:l,ExpressionAttributeNames:c,ExpressionAttributeValues:p,FilterExpression:d}=u(t),h=o({TableName:this.tableName,IndexName:e,KeyConditionExpression:l,ExpressionAttributeNames:c,ExpressionAttributeValues:p,FilterExpression:d,ProjectionExpression:a}),{Count:m}=await this.client.query({...h,Select:"COUNT"}).promise();r&&(h.ScanIndexForward="desc"!==r.dir),s&&(h.Limit=s),n&&(h.ExclusiveStartKey=n);let y=await this.client.query(h).promise(),f=[...y.Items];if("test"===process.env.STAGE&&console.log("params",h),"test"===process.env.STAGE&&console.log("response",y),y.LastEvaluatedKey)for(;y.LastEvaluatedKey;)if(h.ExclusiveStartKey=y.LastEvaluatedKey,y=await this.client.query(h).promise(),"test"===process.env.STAGE&&console.log("w - params",h),"test"===process.env.STAGE&&console.log("w - response",y),s&&f.length+y.Items.length>s){const e=s-f.length;f=f.concat(y.Items.slice(0,e)),y.LastEvaluatedKey=null}else f=f.concat(y.Items);return{count:m,items:f}}}};class d extends class{constructor(e,t){Object.assign(this,{database:e,tableName:t})}async findByKey(e){return this.database.withTable(this.tableName).findByKey(e)}async findAll(){return this.database.withTable(this.tableName).findAll()}async filter({indexName:e,limit:t,skip:s,sort:n,filter:r,attributesToGetString:a}){return this.database.withTable(this.tableName).filter({indexName:e,limit:t,skip:s,sort:n,filter:r,attributesToGetString:a})}async put(e){return this.database.withTable(this.tableName).put(e)}async delete(e){return this.database.withTable(this.tableName).delete(e)}}{constructor(e,t){super(e,t)}}var h={management:a,persistence:{databases:p,UnitOfWork:class{constructor(e,t){Object.assign(this,{database:e,tableName:t}),this.constructor.container=new Map}repository(){const{container:e}=this.constructor,t=new d(this.database,this.tableName);return e.set(this.tableName,t),t}}}},m={hooks:{useUpdate:(e,t)=>{const s=react.useRef(!1);react.useEffect((()=>{s.current?e():s.current=!0}),t)}}},y={math:{guid:function(e,t){var s,n,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=[];if(t=t||r.length,e)for(s=0;s<e;s++)a[s]=r[0|Math.random()*t];else for(a[8]=a[13]=a[18]=a[23]="-",a[14]="4",s=0;s<36;s++)a[s]||(n=0|16*Math.random(),a[s]=r[19==s?3&n|8:n]);return a.join("").toLowerCase()}},string:{toHex:function(e){for(var t="",s=0;s<e.length;s++)t+=e[s].charCodeAt(0).toString(16);return t},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)}},func:{debounce:function(e,t,s){var n;return function(){var r=this,a=arguments,i=function(){n=null,s||e.apply(r,a)},o=s&&!n;clearTimeout(n),n=setTimeout(i,t),o&&e.apply(r,a)}}},network:{request:function(e){return new Promise((function(t,s){var n=new XMLHttpRequest;n.open(e.method||"GET",e.url),e.headers&&Object.keys(e.headers).forEach((function(t){n.setRequestHeader(t,e.headers[t])})),n.onload=function(){t({code:n.status,message:n.response||n.responseText})},n.onerror=function(){s(n.statusText)},n.send(e.body)}))},info:{data:null,load:function(){utility.net.request({url:"https://ipapi.co/json/"}).then((function(e){200===e.code&&(utility.net.info.data=JSON.parse(e.message))})).catch((function(e){utility.net.info.data={}}))}}},http:{response:(e,t="json")=>"json"===t?{statusCode:200,body:JSON.stringify({payload:e}),headers:{"Content-Type":"application/json"}}:{statusCode:200,body:e,isBase64Encoded:!0,headers:{"Access-Control-Allow-Origin":"*","Content-disposition":`attachment; filename=${(new Date).toISOString()}.${"img"===t?"jpg":"pdf"}`,"Content-Type":"img"===t?"image/jpg":"application/pdf"}},size:e=>{let t,s,n;t=e.endsWith("==")?2:e.endsWith("=")?1:0,n=e.length,s=n/4*3-t;return s/1e3}}};e.backEnd=h,e.frontEnd=m,e.utility=y,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=main.min.js.map
